"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[150,502],{61502:function(e,n,t){t.r(n),t.d(n,{default:function(){return J},useShadowRoot:function(){return W},useWebComponentInfo:function(){return Q}});var r=t(29439),i=t(74165),o=t(15861),l=t(24530),s=t(24717),a=t(61724);function u(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0,r=(0,l.Qc)(e),i=(0,s.Vn)(r,{Field:{enter:function(e){var r;if(null!==e&&void 0!==e&&null!==(r=e.directives)&&void 0!==r&&r.find((function(e){var r,i,o,l,s=e.name.value,a=null===(r=e.arguments)||void 0===r?void 0:r[0].name.value,u=null===(i=e.arguments)||void 0===i||null===(o=i[0].value)||void 0===o?void 0:o.value,c=null===(l=e.arguments)||void 0===l?void 0:l[0];if("since"===s&&"version"===a){if(t(u))return!0}else if("deprecatedSince"===s&&"version"===a){var d="StringValue"===(null===c||void 0===c?void 0:c.value.kind)?null===c||void 0===c?void 0:c.value.value:n[null===c||void 0===c?void 0:c.value.name.value];if(!t(d))return!0}else if("skipOnClient"===s&&"if"===a){if("BooleanValue"===(null===c||void 0===c?void 0:c.value.kind)&&c.value.value)return!0;if("Variable"===(null===c||void 0===c?void 0:c.value.kind)&&n[c.value.name.value])return!0}return!1})))return null},leave:function(e){var n;if(e.selectionSet&&"SelectionSet"===e.selectionSet.kind&&0===(null===(n=e.selectionSet.selections)||void 0===n?void 0:n.length))return null}},Directive:{leave:function(e){var n=e.name.value;if(["since","deprecatedSince","skipOnClient"].includes(n))return null}}}),o={};return(0,s.Vn)(i,{Variable:function(e){o[e.name.value]=(o[e.name.value]||0)+1}}),i=(0,s.Vn)(i,{VariableDefinition:{enter:function(e){if(o[e.variable.name.value]<=1)return null}}}),(0,a.S)(i)}var c=t(41011);c.RelayFeatureFlags.ENABLE_RELAY_RESOLVERS=!0;var d=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n,t){var r,o,l,s,a,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==globalThis.backendaiclient){e.next=3;break}return e.next=3,new Promise((function(e){document.addEventListener("backend-ai-connected",(function n(){document.removeEventListener("backend-ai-connected",n),e(void 0)}))}));case 3:return l=u(n.text||"",t,(function(e){var n;return!(null!==(n=globalThis.backendaiclient)&&void 0!==n&&n.isManagerVersionCompatibleWith(e))})),s={query:l,variables:t},a=null===(r=globalThis.backendaiclient)||void 0===r?void 0:r.newSignedRequest("POST","/admin/gql",s),e.next=8,null===(o=globalThis.backendaiclient)||void 0===o?void 0:o._wrapWithPromise(a,!1,null,1e4,0).catch((function(e){}));case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0={};case 11:return c=e.t0,e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();var m,v=new c.Environment({network:c.Network.create(d,void 0),store:new c.Store(new c.RecordSource)}),h=t(80382),p=t(27340),f=t(41239),x=t(47226),g=t(49883),Z=t(66670),y=t(99517),j=t.n(y),b=(t(24989),t(79354)),w=t.n(b),k=t(79748),P=t.n(k),S=t(51714),C=t.n(S),T=t(63540),F=t.n(T),I=t(18272),V=t.n(I),E=t(9666),A=t.n(E),_=t(64447),R=t(13881),B=t(4519),M=t(81748),z=t(87112),K=t(16980),N=t(51843),q=t(12674),G=t(55144),O=t(73181),D=t(2556);j().extend(A()),j().extend(w()),j().extend(P()),j().extend(C()),j().extend(V()),j().extend(F());var L=B.createContext(null),U=B.createContext(null),W=function(){return B.useContext(U)},Q=function(){return B.useContext(L)},$=new z.QueryClient({defaultOptions:{queries:{suspense:!0,refetchOnWindowFocus:!1,retry:!1}}});_.ZP.use(M.Db).use(R.Z).init({backend:{loadPath:"/resources/i18n/{{lng}}.json"},lng:(null===globalThis||void 0===globalThis||null===(m=globalThis.backendaioptions)||void 0===m?void 0:m.get("current_language"))||"en",fallbackLng:"en",interpolation:{escapeValue:!1},react:{transSupportBasicHtmlNodes:!0,transKeepBasicHtmlNodesFor:["br","strong","span","code","p"]}});var H=function(){var e=(0,q.s0)();return(0,B.useLayoutEffect)((function(){var n=function(n){var t=n.detail;e(t,{replace:!0})};return document.addEventListener("react-navigate",n),function(){document.removeEventListener("react-navigate",n)}}),[e]),null},J=function(e){var n=e.children,t=e.value,i=e.styles,o=e.shadowRoot,l=e.dispatchEvent,s=(0,B.useMemo)((function(){return(0,p.Df)()}),[]),a=function(){var e,n=(0,B.useState)(null===globalThis||void 0===globalThis||null===(e=globalThis.backendaioptions)||void 0===e?void 0:e.get("current_language")),t=(0,r.Z)(n,2),i=t[0],o=t[1],l=(0,M.$G)().i18n;return(0,B.useEffect)((function(){setTimeout((function(){return null===l||void 0===l?void 0:l.changeLanguage(i)}),0),j().locale(i)}),[]),(0,B.useEffect)((function(){var e=function(e){var n,t;o(null===e||void 0===e||null===(n=e.detail)||void 0===n?void 0:n.lang);var r=(null===e||void 0===e||null===(t=e.detail)||void 0===t?void 0:t.lang)||"en";null===l||void 0===l||l.changeLanguage(r),j().locale(r)};return window.addEventListener("langChanged",e),function(){return window.removeEventListener("langChanged",e)}}),[l]),[i]}(),u=(0,r.Z)(a,1)[0],c=(0,h.x)(),d=(0,B.useMemo)((function(){return{value:t,dispatchEvent:l,moveTo:function(e,n){l("moveTo",{path:e,params:n})}}}),[t,l]);return(0,D.jsx)(D.Fragment,{children:v&&(0,D.jsx)(K.RelayEnvironmentProvider,{environment:v,children:(0,D.jsxs)(B.StrictMode,{children:[(0,D.jsxs)("style",{children:[i,".anticon {\n  display: inline-block;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n/* fix: fixed column shadow display outside of a table wrapper */\n.ant-table-wrapper {\n  border-radius: 8px 8px 0 0;\n  overflow: hidden;\n}\n\n/* fix: the tooltip does not appear in the `<Form.Item tooltip={'something'}` when the popup container is a parent node of the trigger node. */\n.ant-form-item-label {\n  overflow: unset !important;\n}\n"]}),(0,D.jsx)(z.QueryClientProvider,{client:$,children:(0,D.jsx)(U.Provider,{value:o,children:(0,D.jsx)(L.Provider,{value:d,children:(0,D.jsx)(f.ZP,{getPopupContainer:function(e){return(null===e||void 0===e?void 0:e.parentNode)||o},locale:"ko"===u?Z.Z:g.Z,theme:c,children:(0,D.jsx)(x.Z,{children:(0,D.jsx)(p.V9,{container:o,cache:s,children:(0,D.jsx)(B.Suspense,{fallback:"",children:(0,D.jsx)(N.VK,{children:(0,D.jsxs)(G.QueryParamProvider,{adapter:O.Q,options:{},children:[(0,D.jsx)(H,{}),n]})})})})})})})})})]})})})}},96732:function(e,n,t){t.d(n,{Ec:function(){return v}});var r=t(44925),i=t(1413),o=t(43255),l=t(99277),s=t(44036),a=t(28499),u=t(227),c=(t(4519),t(81748)),d=t(2556),m=["type","size","showIcon","showUnit","showTooltip"],v={"cuda.device":"GPU","cuda.shares":"FGPU","rocm.device":"GPU","tpu.device":"TPU","ipu.device":"IPU","atom.device":"ATOM","warboy.device":"Warboy"},h=function(e){var n=e.size,t=void 0===n?16:n,r=e.children;return(0,d.jsx)("mwc-icon",{style:{"--mdc-icon-size":"".concat(t+2,"px"),width:t,height:t},children:r})},p=function(e){var n,t,o,l=e.type,s=e.size,a=void 0===s?16:s,v=(e.showIcon,e.showUnit,e.showTooltip),p=void 0===v||v,f=(0,r.Z)(e,m),x=(0,c.$G)().t,g={cpu:[(0,d.jsx)(h,{size:a,children:"developer_board"}),x("session.core")],mem:[(0,d.jsx)(h,{size:a,children:"memory"}),"GiB"],"cuda.device":["/resources/icons/file_type_cuda.svg","GPU"],"cuda.shares":["/resources/icons/file_type_cuda.svg","FGPU"],"rocm.device":["/resources/icons/ROCm.png","GPU"],"tpu.device":[(0,d.jsx)(h,{size:a,children:"view_module"}),"TPU"],"ipu.device":[(0,d.jsx)(h,{size:a,children:"view_module"}),"IPU"],"atom.device":["/resources/icons/rebel.svg","ATOM"],"warboy.device":["/resources/icons/furiosa.svg","Warboy"]};return(0,d.jsx)(u.Z,{title:p?"".concat(l," (").concat(g[l][1],")"):void 0,children:"string"===typeof(null===(n=g[l])||void 0===n?void 0:n[0])?(0,d.jsx)("img",(0,i.Z)((0,i.Z)({},f),{},{style:(0,i.Z)({height:a},f.style||{}),src:(null===(t=g[l])||void 0===t?void 0:t[0])||"",alt:l})):(0,d.jsx)("div",{style:{width:16,height:16},children:(null===(o=g[l])||void 0===o?void 0:o[0])||l})})};n.ZP=function(e){var n=e.type,t=e.value,r=e.extra,u=e.opts,m=(0,c.$G)().t,h=s.Z.useToken().token,f=(0,i.Z)({cpu:m("session.core"),mem:"GiB"},v);return(0,d.jsxs)(l.Z,{direction:"row",gap:"xxs",children:[(0,d.jsx)(p,{type:n}),(0,d.jsx)(a.Z.Text,{children:"GiB"===f[n]?(0,o.PZ)(t+"b","g",2).numberFixed:"FGPU"===f[n]?parseFloat(t).toFixed(2):t}),(0,d.jsx)(a.Z.Text,{type:"secondary",children:f[n]}),"mem"===n&&(null===u||void 0===u?void 0:u.shmem)&&(0,d.jsxs)(a.Z.Text,{type:"secondary",style:{fontSize:h.fontSizeSM},children:["(SHM: ",(0,o.PZ)(u.shmem+"b","g",2).numberFixed,"GiB)"]}),r]})}},73340:function(e,n,t){t.r(n);var r=function(){var e=[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSelectQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetSelectQuery",selections:e},params:{cacheID:"bd89430b9924d926a1b8e91191746b4f",id:null,metadata:{},name:"ResourcePresetSelectQuery",operationKind:"query",text:"query ResourcePresetSelectQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n  }\n}\n"}}}();r.hash="9841642e96d89476c2848bfb093ed9c5",n.default=r},73150:function(e,n,t){t.r(n),t.d(n,{default:function(){return Be}});var r,i=t(1413),o=t(29439),l=t(44925),s=t(72183),a=t(44036),u=t(92171),c=t(53066),d=t(32048),m=t.n(d),v=t(4519),h=t(2556),p=["status","extraButtonTitle","onClickExtraButton","extra","style"],f=function(e){var n=e.status,t=void 0===n?"default":n,r=e.extraButtonTitle,o=e.onClickExtraButton,d=e.extra,v=e.style,f=(0,l.Z)(e,p),x=a.Z.useToken().token,g=d||r&&(0,h.jsx)(u.ZP,{type:"link",icon:"error"===t?(0,h.jsx)(s.Z,{twoToneColor:x.colorError}):void 0,onClick:o,children:r})||void 0;return(0,h.jsx)(c.Z,(0,i.Z)({style:m().extend(v,{borderColor:"error"===t?x.colorError:"warning"===t?x.colorWarning:"success"===t?x.colorSuccess:null===v||void 0===v?void 0:v.borderColor}),extra:g},f))},x=t(66957),g=t(99517),Z=t.n(g),y=["value","onChange"],j=function(e){var n=e.value,t=e.onChange,r=(0,l.Z)(e,y);return(0,h.jsx)(x.Z,(0,i.Z)({value:n?Z()(n):void 0,onChange:function(e,n){t&&t(null===e||void 0===e?void 0:e.toISOString())}},r))},b=t(61502),w=t(99277),k=t(74860),P=t(20558),S=t(57054),C=t(38818),T=["formItemProps"],F=["key","name"],I=function(e){var n=e.formItemProps,t=(0,l.Z)(e,T),r=(0,v.useRef)(null);return(0,h.jsx)(S.Z.List,(0,i.Z)((0,i.Z)({},t),{},{children:function(e,t){var o=t.add,s=t.remove;return(0,h.jsxs)(w.Z,{direction:"column",gap:"xs",align:"stretch",children:[e.map((function(t,o){var a=t.key,u=t.name,c=(0,l.Z)(t,F);return(0,h.jsxs)(w.Z,{direction:"row",align:"baseline",gap:"xs",children:[(0,h.jsx)(S.Z.Item,(0,i.Z)((0,i.Z)((0,i.Z)({},c),{},{style:{marginBottom:0,flex:1},name:[u,"variable"],rules:[{required:!0,message:"Enter Variable name"},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:"Variable name must start with a letter or underscore, and can only contain letters, numbers, and underscores."},function(e){var n=e.getFieldValue;return{validator:function(e,t){var r=m().map(n("envList"),(function(e){return null===e||void 0===e?void 0:e.variable}));return r.length>0&&m().filter(r,(function(e){return e===t})).length>1?Promise.reject("Variable name already exists"):Promise.resolve()}}}]},n),{},{children:(0,h.jsx)(C.Z,{ref:o===e.length-1?r:null,placeholder:"Variable"})})),(0,h.jsx)(S.Z.Item,(0,i.Z)((0,i.Z)({},c),{},{name:[u,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:"Enter value"}],children:(0,h.jsx)(C.Z,{placeholder:"Value"})})),(0,h.jsx)(k.Z,{onClick:function(){return s(u)}})]},a)})),(0,h.jsx)(S.Z.Item,{noStyle:!0,children:(0,h.jsx)(u.ZP,{type:"dashed",onClick:function(){o(),setTimeout((function(){r.current&&r.current.focus()}),0)},icon:(0,h.jsx)(P.Z,{}),block:!0,children:"Add variable"})})]})}}))},V=t(34341),E=t(14001),A=t(36459),_=t(19427),R=t(82548),B=t(81748),M=["value"],z=function(e){var n=e.value,t=(0,l.Z)(e,M),r=parseInt(n),o=r>=1024&&r<=65535;return(0,h.jsx)(R.Z,(0,i.Z)({color:o?void 0:"red"},t))},K=function(e){var n=Object.assign({},((0,A.Z)(e),e)),t=(0,B.$G)().t;return(0,h.jsx)(S.Z.Item,(0,i.Z)((0,i.Z)({label:t("session.launcher.PreOpenPortTitle"),name:"ports",tooltip:(0,h.jsx)(B.cC,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:t("session.launcher.PreOpenPortRangeGuide"),rules:[function(e){e.getFieldValue;return{validator:function(e,n){return m().every(n,(function(e){var n=parseInt(e);return n>=1024&&n<=65535}))?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortRange")))}}}]},n),{},{children:(0,h.jsx)(_.Z,{mode:"tags",tagRender:function(e){return(0,h.jsx)(z,{closable:e.closable,onClose:e.onClose,onMouseDown:function(e){e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})}))},N=t(43255),q=t(1839),G=t(96732),O=t(87760),D=t(61749),L=t(73519),U=t(16980),W=function(e){var n=Object.assign({},((0,A.Z)(e),e)),l=(0,O.Kr)("first"),s=(0,o.Z)(l,2),a=s[0],u=s[1],c=(0,L.Z)(u,{wait:3e3,trailing:!1,leading:!0}).run,d=(0,v.useTransition)(),p=(0,o.Z)(d,2),f=p[0],x=p[1],g=(0,U.useLazyLoadQuery)(void 0!==r?r:r=t(73340),{},{fetchKey:a,fetchPolicy:"first"===a?"store-and-network":"network-only"}).resource_presets;return(0,h.jsx)(_.Z,(0,i.Z)((0,i.Z)({loading:f,options:[{value:"custom",label:(0,h.jsxs)(w.Z,{gap:"xs",style:{display:"inline-flex"},children:[(0,h.jsx)(D.Z,{})," Custom"]})},{label:"Preset",options:m().map(g,(function(e){return{value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name,preset:e}}))}],showSearch:!0},n),{},{onDropdownVisibleChange:function(e){e&&(console.log(e),x((function(){c()})))}}))},Q=t(99695),$=function(){var e=S.Z.useFormInstance(),n=(0,B.$G)().t,t=a.Z.useToken().token,r=(0,q.T)(),l=(0,o.Z)(r,1)[0];return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(S.Z.Item,{label:n("resourcePreset.ResourcePresets"),name:"allocationPreset",required:!0,style:{marginBottom:t.marginXS},children:(0,h.jsx)(W,{onChange:function(n,t){var r,o,s=m().pick(JSON.parse((null===t||void 0===t||null===(r=t.preset)||void 0===r?void 0:r.resource_slots)||"{}"),m().keys(l));e.setFieldsValue({resource:(0,i.Z)((0,i.Z)({},s),{},{mem:(0,N.PZ)(((null===s||void 0===s?void 0:s.mem)||0)+"b","g",2).number,shmem:(0,N.PZ)(((null===t||void 0===t||null===(o=t.preset)||void 0===o?void 0:o.shared_memory)||0)+"b","g",2).number})})}})}),(0,h.jsx)(c.Z,{style:{marginBottom:t.margin},children:(0,h.jsx)(S.Z.Item,{shouldUpdate:function(e,n){return e.allocationPreset!==n.allocationPreset},noStyle:!0,children:function(e){e.getFieldValue;return(0,h.jsxs)(h.Fragment,{children:[(null===l||void 0===l?void 0:l.cpu)&&(0,h.jsx)(Q.Z,{name:["resource","cpu"],initialValue:0,label:n("session.launcher.CPU"),tooltip:(0,h.jsx)(B.cC,{i18nKey:"session.launcher.DescCPU"}),inputNumberProps:{addonAfter:n("session.launcher.Core")},required:!0,rules:[{required:!0}]}),(null===l||void 0===l?void 0:l.mem)&&(0,h.jsx)(Q.Z,{name:["resource","mem"],initialValue:0,label:n("session.launcher.Memory"),tooltip:(0,h.jsx)(B.cC,{i18nKey:"session.launcher.DescMemory"}),max:30,inputNumberProps:{addonAfter:"GB"},step:.05,required:!0,rules:[{required:!0}]}),(null===l||void 0===l?void 0:l.mem)&&(0,h.jsx)(Q.Z,{name:["resource","shmem"],initialValue:0,label:n("session.launcher.SharedMemory"),tooltip:(0,h.jsx)(B.cC,{i18nKey:"session.launcher.DescSharedMemory"}),max:30,step:.1,inputNumberProps:{addonAfter:"GB"},required:!0,rules:[{required:!0}]}),m().chain(l).omit(["cpu","mem","shmem"]).map((function(e,t,r){return(0,h.jsx)(Q.Z,{name:["resource",t],initialValue:0,label:n("session.launcher.AIAccelerator"),max:30,step:t.endsWith("shares")?.1:1,inputNumberProps:{addonAfter:(0,h.jsx)(S.Z.Item,{noStyle:!0,name:"acceleratorType",initialValue:m().keys(r)[0],children:(0,h.jsx)(_.Z,{suffixIcon:m().size(r)>1?void 0:null,children:m().map(r,(function(e,n){return(0,h.jsx)(_.Z.Option,{value:n,children:G.Ec[n]||"UNIT"})}))})})},required:!0,rules:[{required:!0}]})})).value()]})}})})]})},H=t(61815),J=t(93433),X=t(74165),Y=t(15861),ee=t(50164),ne=t(37007),te=t(91278),re=t(56713),ie=t(50708),oe=t(72842),le=t(42620),se=t(28499),ae=t(227),ue=t(79876),ce=["filter","showAliasInput","selectedRowKeys","onChangeSelectedRowKeys","aliasBasePath","aliasMap","onChangeAliasMap","rowKey"],de=function(e){var n=e.filter,t=e.showAliasInput,r=void 0!==t&&t,s=e.selectedRowKeys,a=void 0===s?[]:s,c=e.onChangeSelectedRowKeys,d=e.aliasBasePath,p=void 0===d?"/home/work/":d,f=e.aliasMap,x=e.onChangeAliasMap,g=e.rowKey,y=void 0===g?"name":g,j=(0,l.Z)(e,ce),k=v.useMemo((function(){return function(e){return e&&e[y]}}),[y]),P=(0,le.Z)({value:a,onChange:c},{defaultValue:[]}),T=(0,o.Z)(P,2),F=T[0],I=T[1],V=(0,le.Z)({value:f,onChange:x},{defaultValue:{}}),E=(0,o.Z)(V,2),A=E[0],_=E[1],R=S.Z.useForm(),M=(0,o.Z)(R,1)[0];(0,v.useEffect)((function(){A&&(M.setFieldsValue(m().mapValues(A,(function(e){return e.startsWith(p)?e.slice(p.length):e}))),M.validateFields())}),[A,M,p]);var z=(0,B.$G)().t,K=(0,N.y3)(),q=(0,O.qh)(),G=(0,O.Kr)("first"),D=(0,o.Z)(G,2),L=D[0],U=D[1],W=(0,v.useTransition)(),Q=(0,o.Z)(W,2),$=Q[0],H=Q[1],de=(0,ee.h)({queryKey:["VFolderSelectQuery",L],queryFn:function(){return K({method:"GET",url:"/folders?group_id=".concat(q.id)})},staleTime:0}).data,me=(0,v.useState)(""),ve=(0,o.Z)(me,2),he=ve[0],pe=ve[1],fe=m().filter(de,(function(e){return!!F.includes(k(e))||(!n||n(e))&&(!he||e.name.includes(he))})),xe=function(e){null===e||void 0===e||e.preventDefault(),M.validateFields().then((function(e){})).catch((function(){})).finally((function(){_(m().mapValues(m().pickBy(M.getFieldsValue(),(function(e){return!!e})),(function(e,n){return ge(n,e)})))}))},ge=function(e,n){return m().isEmpty(n)?"".concat(p).concat(e):null!==n&&void 0!==n&&n.startsWith("/")?n:"".concat(p).concat(n)},Ze=(0,b.useShadowRoot)(),ye=[{title:(0,h.jsxs)(w.Z,{direction:"row",gap:"xxs",children:[(0,h.jsx)(se.Z.Text,{children:z("data.folders.Name")}),r&&(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)(se.Z.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",z("session.launcher.FolderAlias")," ",(0,h.jsx)(ae.Z,{title:(0,h.jsx)(B.cC,{i18nKey:"session.launcher.DescFolderAlias"}),style:{zIndex:1e4},getPopupContainer:function(){return Ze},children:(0,h.jsx)(re.Z,{})}),")"]})})]}),dataIndex:"name",sorter:function(e,n){return e.name.localeCompare(n.name)},render:function(e,n){var t=F.includes(k(n));return(0,h.jsxs)(w.Z,{direction:"column",align:"stretch",gap:"xxs",style:r&&t?{display:"inline-flex",height:70,width:"100%"}:void 0,children:[(0,h.jsx)(te.Z,{keyword:he,children:e}),r&&t&&(0,h.jsx)(S.Z.Item,{noStyle:!0,shouldUpdate:function(e,t){return e[k(n)]!==t[k(n)]},children:function(){var e=m()(F).reduce((function(e,n){return e[n]=(null===A||void 0===A?void 0:A[n])||ge(n,void 0),e}),{});return(0,h.jsx)(S.Z.Item,{name:k(n),rules:[{type:"string",pattern:/^[a-zA-Z0-9_/-]*$/,message:z("session.launcher.FolderAliasInvalid")},{type:"string",validator:function(){var t=(0,Y.Z)((0,X.Z)().mark((function t(r,i){return(0,X.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i||!m().some(e,(function(e,t){return t!==k(n)&&e===ge(k(n),i)}))){t.next=2;break}return t.abrupt("return",Promise.reject(z("session.launcher.FolderAliasOverlapping")));case 2:return t.abrupt("return",Promise.resolve());case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}],extra:ge(n.name,M.getFieldValue(k(n))),children:(0,h.jsx)(C.Z,{onClick:function(e){e.stopPropagation()},placeholder:z("session.launcher.FolderAlias"),onChange:xe,allowClear:!0})})}})]})},fixed:"left"},{title:z("data.UsageMode"),dataIndex:"usage_mode",sorter:function(e,n){return e.usage_mode.localeCompare(n.usage_mode)}},{title:z("data.Host"),dataIndex:"host"},{title:z("data.Type"),dataIndex:"type",sorter:function(e,n){return e.type.localeCompare(n.type)},render:function(e,n){return(0,h.jsxs)(w.Z,{direction:"column",children:["user"===n.type?(0,h.jsx)(ie.Z,{title:"User"}):(0,h.jsx)("div",{children:"Group"}),"group"===n.type&&"(".concat(n.group_name,")")]})}},{title:z("data.Permission"),dataIndex:"permission",sorter:function(e,n){return e.permission.localeCompare(n.permission)},render:function(e,n){var t=m().chain({r:"green",w:"blue",d:"red"}).map((function(e,t){if(function(e,n){return!!e.permission.includes(n)||!(!e.permission.includes("w")||"r"!==n)}(n,t))return{label:t.toUpperCase(),color:e}})).compact().value();return(0,h.jsx)(ne.Z,{values:t})}},{title:z("data.Created"),dataIndex:"created_at",sorter:function(e,n){return e.created_at.localeCompare(n.created_at)},render:function(e,n){return Z()(e).format("L")}}];return(0,h.jsxs)(w.Z,{direction:"column",align:"stretch",gap:"xs",children:[(0,h.jsxs)(w.Z,{direction:"row",gap:"xs",justify:"between",children:[(0,h.jsx)(C.Z,{value:he,onChange:function(e){return pe(e.target.value)},allowClear:!0,placeholder:z("data.SearchByName")}),(0,h.jsx)(u.ZP,{loading:$,icon:(0,h.jsx)(oe.Z,{}),onClick:function(){H((function(){U()}))}})]}),(0,h.jsx)(S.Z,{form:M,children:(0,h.jsx)(ue.Z,(0,i.Z)({scroll:{x:"max-content"},rowKey:k,rowSelection:{selectedRowKeys:F,onChange:function(e){I(e),xe()}},showSorterTooltip:!1,columns:ye,dataSource:fe,onRow:function(e,n){return{onClick:function(n){var t,r=n.target;null!==r&&void 0!==r&&null!==(t=r.classList)&&void 0!==t&&t.contains("ant-table-selection-column")&&(n.stopPropagation(),F.includes(k(e))?I(F.filter((function(n){return n!==k(e)}))):I([].concat((0,J.Z)(F),[k(e)])))}}}},j))})]})},me=function(e){var n=Object.assign({},((0,A.Z)(e),e)),t=S.Z.useFormInstance(),r=(0,B.$G)().t;return S.Z.useWatch("vfoldersAliasMap",t),(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(S.Z.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator:function(e,n){var i=m().chain(t.getFieldValue("mounts")).reduce((function(e,t){return e[t]=n[t]||"/home/work/"+t,e}),{}).values().value();return m().uniq(i).length!==i.length?Promise.reject(r("session.launcher.FolderAliasOverlapping")):Promise.resolve()}}],children:(0,h.jsx)(C.Z,{})}),(0,h.jsx)(S.Z.Item,(0,i.Z)((0,i.Z)({name:"mounts"},n),{},{valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,h.jsx)(de,{rowKey:"name",showAliasInput:!0,aliasMap:t.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:function(e){t.setFieldValue("vfoldersAliasMap",e),t.validateFields(["vfoldersAliasMap"])},pagination:!1})}))]})},ve=t(92331),he=t(91428),pe=t(70442),fe=t(84239),xe=t(89898),ge=t(99269),Ze=t(90632),ye=t(46734),je=t(60284),be=t(15850),we=t(14634),ke=t(93448),Pe=t(88464),Se=t(32461),Ce=t(48196),Te=t(17490),Fe=t(4996),Ie=t(5936),Ve=t(55144),Ee={sessionType:"interactive",allocationPreset:"custom"},Ae=(0,Ve.withDefault)(Ve.NumberParam,0),_e=(0,Ve.withDefault)(Ve.JsonParam,Ee),Re=function(e){var n=e.title,t=e.description,r=a.Z.useToken().token;return(0,h.jsxs)(w.Z,{direction:"column",style:{padding:r.paddingXS},align:"stretch",children:[(0,h.jsx)(se.Z.Title,{level:5,children:n}),(0,h.jsx)(se.Z.Text,{type:"secondary",style:{textWrap:"wrap"},children:t})]})},Be=function(){var e,n,t,r,l,s,d=(0,Ve.useQueryParams)({step:Ae,formValues:_e,redirectTo:Ve.StringParam}),p=(0,o.Z)(d,2),x=p[0],g=x.step,Z=x.formValues,y=x.redirectTo,k=p[1],P=(0,b.useWebComponentInfo)().moveTo,T=(0,Ze.Z)((function(){k({formValues:D.getFieldsValue()},"replaceIn")}),{leading:!1,wait:500,trailing:!0}).run,F=function(e){k({step:e},"pushIn")},A=a.Z.useToken().token,M=(0,B.$G)().t,q=ye.ZP.useBreakpoint(),O=S.Z.useForm(),D=(0,o.Z)(O,1)[0];(0,v.useEffect)((function(){JSON.stringify(Ee)!==JSON.stringify(Z)&&D.validateFields().catch((function(e){}))}),[]),(0,v.useEffect)((function(){}),[g]);var L=S.Z.useWatch("sessionType",D)||D.getFieldValue("sessionType")||Z.sessionType,U=m().filter([{title:M("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(M("session.launcher.Environments")," & ").concat(M("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==L&&{title:M("webui.menu.Data&Storage"),key:"storage"},{title:M("session.launcher.Network"),key:"network"},{title:M("session.launcher.ConfirmAndLaunch"),icon:(0,h.jsx)(ve.Z,{}),key:"review"}],(function(e){return!!e})),W=null===(e=U[g])||void 0===e?void 0:e.key,Q=m().some(D.getFieldsError(),(function(e){return e.errors.length>0}));return(0,h.jsxs)(w.Z,{direction:"column",align:"stretch",style:{padding:A.paddingSM,width:"100%",justifyContent:"revert"},children:[y&&(0,h.jsx)(je.Z,{items:[{title:M("webui.menu.Sessions"),onClick:function(e){e.preventDefault(),P(y)},href:y},{title:M("session.launcher.StartNewSession")}]}),(0,h.jsxs)(w.Z,{direction:"row",gap:"md",align:"start",children:[(0,h.jsxs)(w.Z,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,h.jsxs)(w.Z,{direction:"row",justify:"between",children:[(0,h.jsx)(se.Z.Title,{level:3,style:{marginTop:0},children:M("session.launcher.StartNewSession")}),(0,h.jsx)(u.ZP,{type:"link",icon:(0,h.jsx)(he.Z,{}),children:"Templates"})]}),(0,h.jsx)(S.Z.Provider,{onFormChange:function(e,n){T()},children:(0,h.jsx)(S.Z,{form:D,layout:"vertical",requiredMark:"optional",children:(0,h.jsxs)(w.Z,{direction:"column",align:"stretch",gap:"md",children:[(0,h.jsxs)(c.Z,{title:M("session.launcher.SessionType"),style:{display:"sessionType"===W?"block":"none"},children:[(0,h.jsx)(S.Z.Item,{name:"sessionType",children:(0,h.jsx)(be.Z,{width:100,options:[{label:(0,h.jsx)(Re,{title:"\ud83c\udfc3\u200d\u2640\ufe0f Make, test and run",description:"Interactive mode allows you to create, test and run code interactively via jupyter notebook, visual studio code, etc."}),value:"interactive"},{label:(0,h.jsx)(Re,{title:"\u231a\ufe0f Start an long-running task",description:"Batch mode runs your code with multiple node & clusters to scale your idea"}),value:"batch"}]})}),(0,h.jsx)(S.Z.Item,{label:"Session name",name:"name",rules:[{max:64,message:M("session.Validation.SessionNameTooLong64")},{pattern:/^(?:[a-zA-Z0-9][a-zA-Z0-9._-]{2,}[a-zA-Z0-9])?$/,message:M("session.Validation.PleaseFollowSessionNameRule").toString()}],children:(0,h.jsx)(C.Z,{allowClear:!0})})]}),"batch"===L&&(0,h.jsxs)(c.Z,{title:"Batch Mode Configuration",style:{display:"sessionType"===W?"block":"none"},children:[(0,h.jsx)(S.Z.Item,{label:M("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0}],children:(0,h.jsx)(C.Z.TextArea,{})}),(0,h.jsx)(S.Z.Item,{label:"Schedule time",children:(0,h.jsxs)(w.Z,{direction:"row",gap:"xs",children:[(0,h.jsx)(S.Z.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,h.jsx)(we.Z,{children:M("session.launcher.Enable")})}),(0,h.jsx)(S.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var t,r;return(null===(t=e.batch)||void 0===t?void 0:t.enabled)!==(null===(r=n.batch)||void 0===r?void 0:r.enabled)},children:function(){var e,n=!0!==(null===(e=D.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(S.Z.Item,{name:["batch","scheduleDate"],noStyle:!0,children:(0,h.jsx)(j,{disabled:n,showTime:!0})})})}})]})})]}),"inference"===L&&(0,h.jsx)(c.Z,{title:"Inference Mode Configuration",children:(0,h.jsx)(S.Z.Item,{name:["inference","vFolderName"],label:M("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,h.jsx)(_.Z,{})})}),(0,h.jsxs)(c.Z,{title:M("session.launcher.Environments"),style:{display:"environment"===W?"block":"none"},children:[(0,h.jsx)(Te.SV,{fallbackRender:function(e){return console.log(e),null},children:(0,h.jsx)(V.Z,{})}),(0,h.jsx)(S.Z.Item,{label:"Environment Variables",children:(0,h.jsx)(I,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,h.jsxs)(c.Z,{title:M("session.launcher.ResourceAllocation"),style:{display:"environment"===W?"block":"none"},children:[(0,h.jsx)(S.Z.Item,{name:"resourceGroup",label:M("session.ResourceGroup"),rules:[{required:!0}],children:(0,h.jsx)(H.Z,{autoSelectDefault:!0})}),(0,h.jsx)($,{})]}),(0,h.jsx)(c.Z,{title:M("webui.menu.Data&Storage"),style:{display:"storage"===W?"block":"none"},children:(0,h.jsx)(me,{})}),(0,h.jsx)(c.Z,{title:M("session.launcher.Network"),style:{display:"network"===W?"block":"none"},children:(0,h.jsx)(K,{})}),"review"===W&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(f,{title:M("session.launcher.SessionType"),size:"small",status:D.getFieldError("name").length>0?"error":void 0,extraButtonTitle:M("button.Edit"),onClickExtraButton:function(){F(U.findIndex((function(e){return"sessionType"===e.key})))},children:(0,h.jsxs)(ke.Z,{size:"small",children:[(0,h.jsx)(ke.Z.Item,{label:"Session Type",span:24,children:D.getFieldValue("sessionType")}),(0,h.jsx)(ke.Z.Item,{label:"Session name",span:24,children:D.getFieldValue("name")})]})}),(0,h.jsx)(f,{title:M("session.launcher.Environments"),size:"small",status:m().some(D.getFieldValue("envvars"),(function(e,n){return D.getFieldError(["envvars",n,"variable"]).length>0||D.getFieldError(["envvars",n,"value"]).length>0}))?"error":void 0,extraButtonTitle:M("button.Edit"),onClickExtraButton:function(){F(U.findIndex((function(e){return"environment"===e.key})))},children:(0,h.jsxs)(ke.Z,{size:"small",layout:"vertical",column:1,children:[(0,h.jsx)(ke.Z.Item,{label:"Image",children:(0,h.jsxs)(w.Z,{direction:"row",gap:"xs",style:{flex:1},children:[(0,h.jsx)(E.Z,{image:null===(n=D.getFieldValue("environments"))||void 0===n?void 0:n.version}),(0,h.jsx)(se.Z.Text,{copyable:!0,code:!0,children:null===(t=D.getFieldValue("environments"))||void 0===t?void 0:t.version})]})}),(0,h.jsx)(ke.Z.Item,{label:M("session.launcher.EnvironmentVariable"),children:null!==(r=D.getFieldValue("envvars"))&&void 0!==r&&r.length?(0,h.jsx)(Fe.Z,{style:Ie.Z,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:m().map(D.getFieldValue("envvars"),(function(e){return"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"')})).join("\n")}):"-"})]})}),(0,h.jsx)(c.Z,{title:M("session.launcher.ResourceAllocation"),size:"small",extra:(0,h.jsx)(u.ZP,{type:"link",onClick:function(){F(U.findIndex((function(e){return"environment"===e.key})))},children:M("button.Edit")}),children:(0,h.jsx)(ke.Z,{children:(0,h.jsx)(ke.Z.Item,{span:24,label:M("environment.ResourcePresets"),children:(0,h.jsxs)(w.Z,{direction:"row",align:"start",gap:"xs",wrap:"wrap",style:{flex:1},children:["custom"===D.getFieldValue("allocationPreset")?"":(0,h.jsx)(R.Z,{children:D.getFieldValue("allocationPreset")}),m().map(m().omit(D.getFieldValue("resource"),"shmem"),(function(e,n){return(0,h.jsx)(G.ZP,{type:n,value:"mem"===n?(0,N.PZ)(e+"g","b").number+"":e,opts:{shmem:D.getFieldValue("resource").shmem?(0,N.PZ)(D.getFieldValue("resource").shmem+"g","b").number:void 0}},n)}))]})})})}),(0,h.jsx)(f,{title:M("webui.menu.Data&Storage"),size:"small",status:D.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:M("button.Edit"),onClickExtraButton:function(){F(U.findIndex((function(e){return"storage"===e.key})))},children:(null===(l=D.getFieldValue("mounts"))||void 0===l?void 0:l.length)>0?(0,h.jsx)(ue.Z,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:M("data.folders.Name")},{dataIndex:"alias",title:M("session.launcher.FolderAlias"),render:function(e,n){return m().isEmpty(e)?(0,h.jsx)(se.Z.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(n.name)}):e}}],dataSource:m().map(D.getFieldValue("mounts"),(function(e){var n;return{name:e,alias:null===(n=D.getFieldValue("vfoldersAliasMap"))||void 0===n?void 0:n[e]}}))}):"-"}),(0,h.jsx)(f,{title:"Network",size:"small",status:D.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:M("button.Edit"),onClickExtraButton:function(){F(U.findIndex((function(e){return"network"===e.key})))},children:(0,h.jsx)(ke.Z,{size:"small",children:(0,h.jsx)(ke.Z.Item,{label:M("session.launcher.PreOpenPortTitle"),children:(0,h.jsxs)(w.Z,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[m().sortBy(D.getFieldValue("ports"),(function(e){return parseInt(e)})).map((function(e){return(0,h.jsx)(z,{value:e,style:{margin:0},children:e})})),0!==(null===(s=D.getFieldValue("ports"))||void 0===s?void 0:s.length)?void 0:"-"]})})})})]}),(0,h.jsxs)(w.Z,{direction:"row",justify:"between",children:[(0,h.jsx)(w.Z,{gap:"sm",children:g===U.length-1&&(0,h.jsx)(u.ZP,{icon:(0,h.jsx)(pe.Z,{}),onClick:function(){Pe.ZP.info("Not implemented yet: Template edit modal")},children:"Save as a template"})}),(0,h.jsxs)(w.Z,{direction:"row",gap:"sm",children:[g!==U.length-1&&(0,h.jsx)(u.ZP,{onClick:function(){F(U.length-1)},children:"Skip to Review"}),g>0&&(0,h.jsx)(u.ZP,{onClick:function(){F(g-1)},icon:(0,h.jsx)(fe.Z,{}),children:"Previous"}),g===U.length-1?(0,h.jsx)(u.ZP,{type:"primary",icon:(0,h.jsx)(xe.Z,{}),disabled:Q,children:M("session.launcher.Launch")}):(0,h.jsxs)(u.ZP,{type:"primary",ghost:!0,onClick:function(){F(g+1)},children:["Next ",(0,h.jsx)(ge.Z,{})]})]})]})]})})})]}),q.md&&(0,h.jsx)(Se.Z,{offsetTop:150,style:{zIndex:2},children:(0,h.jsx)(Ce.Z,{size:"small",direction:"vertical",current:g,onChange:function(e){F(e)},items:m().map(U,(function(e,n){return(0,i.Z)((0,i.Z)({},e),{},{status:n===g?"process":"wait"})}))})})]})]})}}}]);
//# sourceMappingURL=150.aeb9622e.chunk.js.map